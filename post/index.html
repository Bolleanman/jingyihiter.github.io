<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.15" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel='stylesheet' href='//fonts.googleapis.com/css?family=Open+Sans|Marcellus+SC'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <link rel="stylesheet" href="http://jingyihiter.github.io/css/styles.css">
    <link rel="stylesheet" href="http://jingyihiter.github.io/css/custom.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://jingyihiter.github.io//index.xml">

    
    <title>Posts - jingyihiter 博客</title>
    <meta property='og:title' content="Posts - jingyihiter 博客">
    <meta property="og:type" content="article">
    

    <meta property="og:url" content="http://jingyihiter.github.io/post/">
    
    

  </head>

  <body>

    <header class="site">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://jingyihiter.github.io/">jingyihiter 博客</a>
          </div>

          <div id="navbar" class="collapse navbar-collapse">
            
            <ul class="nav navbar-nav navbar-right">
              
              
              <li><a href="http://jingyihiter.github.io/about/">about me</a></li>
              
              
              
              <li><a href="http://jingyihiter.github.io/contact/">contact</a></li>
              
              
            </ul>
            
          </div>

        </div>
      </nav>
    </header>

    <div class="site">
      <div class="container">


<div class="list">

  <div class="row">
    <div class="col-md-8">
      <header class="page-title">Posts</header>

      
      <article class="li">
  <header>
    <div class="date">Sun, May 15, 2016</div>
    <div class="title"><a href="http://jingyihiter.github.io/post/second/">second blog</a></div>
  </header>
  <div class="body"></div>

  
</article>
<hr>

      
      <article class="li">
  <header>
    <div class="date">Sun, May 15, 2016</div>
    <div class="title"><a href="http://jingyihiter.github.io/post/first/">my first blog</a></div>
  </header>
  <div class="body">my first blog view code #include &lt;stdio.h&gt; #include &lt;Windows.h&gt; #include &lt;process.h&gt; #include &lt;string.h&gt; #include &lt;tchar.h&gt; #pragma comment(lib,&quot;Ws2_32.lib&quot;) #define MAXSIZE 65507 //发送数据报文的最大长度 #define HTTP_PORT 80 //http服务器端口 //Http 重要头部数据 struct HttpHeader{ char method[4]; // POST或者GET，注意有些伪CONNECT，本实验暂不考虑 char url[1024]; // 请求的url char host[1024]; // 目标主机 char cookie[1024 * 10]; //cookie HttpHeader(){ ZeroMemory(this, sizeof(HttpHeader)); } }; // HttpCache 缓存中的数据 struct HttpCache{ char url[1024]; char host[1024]; char last_modified[200]; char status[4]; char buffer[MAXSIZE]; HttpCache(){ ZeroMemory(this, sizeof(HttpCache)); } }; //cache中使用到的参数 HttpCache Cache[1024]; int cached_number = 0;//已经缓存的url数 int last_cache = 0;//上一次缓存的索引 //代理相关参数 SOCKET ProxyServer; sockaddr_in ProxyServerAddr; const int ProxyPort = 12345; //网站过滤用到的参数 char acl[1024][1024];//访问控制表 int acl_number = 0;//已经过滤的网站数 //用户过滤用到的参数 char doa_ip[1024][17];//禁止访问的用户的IP,deny of access int ip_number = 0;//已经禁止的用户数 //钓鱼网站用到的网页 char fishing_host[1024][1024];//钓鱼的网站，都重定向到today.hit.edu.cn int host_number = 0; //钓鱼的网站数 //由于新的连接都使用新线程进行处理，对线程的频繁的创建和销毁特别浪费资源 //可以使用线程池技术提高服务器效率 //const int ProxyThreadMaxNum = 20; //HANDLE ProxyThreadHandle[ProxyThreadMaxNum] = {0}; //DWORD ProxyThreadDW[ProxyThreadMaxNum] = {0}; struct ProxyParam{ SOCKET clientSocket; SOCKET serverSocket; }; bool InitSocket(); int ParseHttpHead(char *buffer, HttpHeader *httpHeader); bool ConnectToServer(SOCKET *serverSocket, char *host); unsigned int __stdcall ProxyThread(LPVOID lpParameter); void ParseCache(char *buffer, char *status, char* last_modified); int _tmain(int argc, _TCHAR* argv[]){ printf(&quot;代理服务器正在启动\n&quot;); printf(&quot;初始化...\n&quot;); if (!InitSocket()){ printf(&quot;socket 初始化失败\n&quot;); return -1; } printf(&quot;代理服务器正在运行，监听端口 %d\n&quot;, ProxyPort); SOCKET acceptSocket = INVALID_SOCKET; SOCKADDR_IN acceptAddr; ProxyParam *lpProxyParam; HANDLE hThread; DWORD dwThreadID; char user_ip[16]; //代理服务器不断监听 while (true){ acceptSocket = accept(ProxyServer, (sockaddr*)&amp;acceptAddr, NULL);//在代理服务器上创建新的socket(acceptSocket)与客户通信 printf(&quot;用户的IP：%s\n&quot;, inet_ntoa(acceptAddr.sin_addr)); memcpy(user_ip, inet_ntoa(acceptAddr.sin_addr), 16); //用户过滤 for (int i = 0; i &lt; ip_number; i++){ if (strcmp(user_ip, doa_ip[i]) == 0){ printf(&quot;用户:%s被禁止访问\n&quot;, user_ip); printf(&quot;套接字关闭\n&quot;); closesocket(acceptSocket); continue; } } lpProxyParam = new ProxyParam; if (lpProxyParam == NULL){ continue; } lpProxyParam-&gt;clientSocket = acceptSocket;//acceptSocket作为与客户端连接的socket hThread = (HANDLE)_beginthreadex(NULL, 0, &amp;ProxyThread, (LPVOID)lpProxyParam, 0, 0); //不调用CloseHandle的话会造成内存泄漏 CloseHandle(hThread); Sleep(200); } closesocket(ProxyServer); WSACleanup(); return 0; } //************************************ // Method: InitSocket // FullName: InitSocket // Access: public // Returns: BOOL // Qualifier: 初始化套接字 //************************************ bool InitSocket(){ //加载套接字库（必须） WORD wVersionRequested; WSADATA wsaData; //套接字加载时错误提示 int err; //版本 2.2 wVersionRequested = MAKEWORD(2, 2); //加载 dll 文件 Scoket 库,第一个参数是请求的Socket版本，第二个参数返回请求的Socket的版本信息。 //第一个参数的高位字节指明副版本、低位字节指明主版本 //当一个应用程序调用WSAStartup函数时，操作系统根据请求的Socket版本来搜索相应的Socket库， //然后绑定找到的Socket库到该应用程序中。 //以后应用程序就可以调用所请求的Socket库中的其它Socket函数了。 err = WSAStartup(wVersionRequested, &amp;wsaData); if (err != 0){ //找不到 winsock.dll printf(&quot;加载 winsock 失败，错误代码为: %d\n&quot;, WSAGetLastError()); return FALSE; } //高位字节指明副版本、低位字节指明主版本 if (LOBYTE(wsaData.wVersion) != 2 || HIBYTE(wsaData.wVersion) != 2) { printf(&quot;不能找到正确的 winsock 版本\n&quot;); WSACleanup();//终止Winsock 2 DLL (Ws2_32.dll)的使用.</div>

  
  <footer>
    <a href="http://jingyihiter.github.io/post/first/" class="btn btn-default">Read More…</a>
  </footer>
  
</article>
<hr>

      
      


    </div>
    <div class="col-md-4">
      
<aside class="site">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">LatestPosts</h2>
    </div>
    <div class="list-group">
      
      <a href="http://jingyihiter.github.io/contact/" class="list-group-item">contact</a>
      
      <a href="http://jingyihiter.github.io/about/" class="list-group-item">about me</a>
      
      <a href="http://jingyihiter.github.io/post/second/" class="list-group-item">second blog</a>
      
      <a href="http://jingyihiter.github.io/post/first/" class="list-group-item">my first blog</a>
      
    </div>
  </div>

  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">category</h2>
    </div>
    <div class="list-group">
      
    </div>
  </div>
  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">tag</h2>
    </div>
    <div class="list-group">
      
    </div>
  </div>
  

</aside>


    </div>
  </div>

</div>
      </div>
    </div>

    <footer class="site">
      <div class="container">
        <p>Copyright (c) 2015 - 2016, @jingyihiter; all rights reserved.</p>
        <p>Powered by <a href="http://jingyihiter.github.io" target="_blank" rel="nofollow">JingYi</a>, Theme <a href="https://github.com/dim0627/hugo_theme_beg" target="_blank" rel="nofollow">beg</a> designed by <a href="http://yet.unresolved.xyz" target="_blank" rel="nofollow">Daisuke Tsuji</a></p>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-2.2.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    

  </body>
</html>

